# Методология сборки

На текущем этапе развития веб-технологий большинство сайтов реализованы как сложные многоуровневые структуры данных. Задача разработчиков - сделать работу с кодом сайта максимально эффективной, избегая громоздких конструкций.

Сайт логично разбивать на множество маленьких взаимосвязанных блоков, с которыми удобно работать. Существуют методологии создания веб-проектов, предлагающие альтернативные предметные области и готовые решения для структурирования проектов. К ним относится и [БЭМ](http://ru.bem.info).

Дробление сайта на сущности и использование абстракций значительно повышают скорость разработки проекта. Однако, удобство файловой организации и легкочитаемость кода приводят к тому, что файлы обрабатываются браузером медленнее обычного. При масштабности современных сайтов нагрузка на сервер становится неоправданно высокой.

Руководствуясь принципом "разделяй и властвуй", оптимальнее всего отделить процесс разработки страниц от их обработки браузером. При этом появляется понятие **сборки сайта** - согласования взаимосвязей между сущностями и библиотеками сайта, а также приведения его кода к наиболее компактному виду.

![Код для людей в код для роботов](https://img-fotki.yandex.ru/get/16165/158800653.0/0_111c55_72635305_orig)

В ходе сборки на основе исходных файлов создаются новые, оптимизированные для передачи роботу. Обычно сборка представляет собой завершающий этап разработки проекта и производится автоматически. Автоматизировать процесс помогают **инструменты сборки**. Некоторые сборщики позволяют собирать проекты параллельно с написанием кода, запуская режим сервера и делая промежуточный результат доступным в браузере.

Важно отметить, что процесс сборки производится локально, и на сервер всегда выкладывается уже собранный проект.

## Файловая система проекта

Рассмотрим файловую систему и конфигурационные файлы сборки на примере типичной структуры БЭМ-проекта:

```sh
.bem/      # конфигурация сборщика
└── make.js
blocks/      # блоки
bundles/      # бандлы
├── index/      # папка бандла
    ├── index.bemjson.js      # JS-декларация бандла
bower.json      # config-файл, отвечающий за подключение библиотек
...
```

### Конфигурационные файлы сборки

Расположенный в корневой папке [bower.json](http://ru.bem.info/tutorials/start-with-project-stub/#Подключение-библиотек) позволяет подключить к проекту нужные библиотеки. Для этого нужно добавить имя и версию/адрес библиотеки в `dependencies`.

За конфигурацию процесса сборки, как правило, отвечают соответствующие JavaScript-файлы, расположенные в папке сборщика.

### Папки блоков

В папках блоков размещаются файлы технологий, касающиеся данного блока. К примеру,

```sh
blocks/
├── button/      # папка блока button
    ├── button.html
    ├── button.css
    ├── button.js
```
[Подробнее](http://ru.bem.info/method/filesystem/) о файловой системе БЭМ-проекта.

<a name="decl"></a>
### Декларации бандлов

Отдельные фрагменты сайта мы, как правило, выделяем в *бандлы*. Примером бандла может служить шапка сайта, включающая в себя блоки логотипа, меню и поиска. Шапка - повторяющийся от страницы к странице фрагмент, поэтому логично декларировать все ее зависимости в одном файле и генерировать для нее отдельный пакет итоговых файлов.

Декларация перечисляет сущности бандла согласно определенным правилам и указывает:

* какие блоки сайта собирать;
* какие библиотеки подключать;
* как сущности зависят друг от друга, и т.д.

На основании декларации инструменты сборки подтягивают все составляющие бандла и зависящие от них блоки.

Формат декларации произволен. Теоретически можно обойтись без нее вовсе и написать плоский список всех компонентов сайта вручную.

## Стандартный процесс сборки

Представим, как обычно проходит процесс сборки.

Допустим, разработчики договорились о предметной области своего проекта. Они легко ориентируются в файловой структуре сайта, быстро находят и правят нужные блоки.

Решено проверить, как сайт будет выглядеть в браузере. Для этого выбирают определенный инструмент сборки и пишут для него [декларацию](#decl).

После этого, с помощью стандартной команды сборщика запускают сам процесс сборки. На основании декларации, а также собственных алгоритмов, сборщик:

* оптимизирует код (например, раскрывает `include` в CSS);
* задействует нужные шаблоны;
* подключает сущности из библиотек согласно зависимостям;
* объединяет раздробленные маленькие файлы в цельные, по предназначению;
* удаляет служебные знаки (например, отступы и пробелы) и т.д.

В итоге генерируется набор файлов, с которым совершенно неудобно работать человеку, но который займёт наименьшее место на сервере и будет обработан браузером максимально быстро.

Для своего проекта вы можете написать уникальный инструмент сборки или использовать один из уже существующих:

* [Gulp](http://gulpjs.com/)
* [Grunt](http://gruntjs.com/)
* [Brunch](http://brunch.io/)
* [Broccoli](https://www.npmjs.org/package/broccoli)
* [ENB](http://enb-make.info/)

Процесс сборки для платформы `БЭМ` имеет свои [особенности](sborka_platform.md), однако в общих чертах совпадает с описанным выше.
